!function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=3)}([function(e,t){e.exports=videojs},function(e,t,i){"use strict";function r(){}var s={};function n(e){var t=s[e];t&&(clearTimeout(t),delete s[e])}function a(e,t,i){var r=document.createElement("iframe");return r.src=t||"about:blank",r.marginWidth="0",r.marginHeight="0",r.frameBorder="0",r.width="100%",r.height="100%",o(r),i&&(r.style.zIndex=i),r.setAttribute("SCROLLING","NO"),e.innerHTML="",e.appendChild(r),r}function o(e){e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.margin="0px",e.style.padding="0px",e.style.border="none",e.style.width="100%",e.style.height="100%"}function l(e,t){return Object.keys(t).forEach((function(i){var r="object"==typeof r?JSON.stringify(t[i]):t[i];e=e.replace(new RegExp("{{"+i+"}}","g"),r)})),e}function c(e,t){var i=e.contentWindow&&e.contentWindow.document;return!!i&&(i.write(t),!0)}e.exports={noop:r,validate:function(e,t){return e?null:new Error(t)},clearCallbackTimeout:n,callbackTimeout:function(e,t,i){var a,o;return o=setTimeout((function(){t=r,delete o[a],i()}),e),s[a=function(){t.apply(this,arguments)&&n(a)}]=o,a},createElementInEl:function(e,t,i){var r=document.createElement(t);return i&&(r.id=i),e.appendChild(r),r},createIframeWithContent:function(e,t,i){var r=a(e,null,i.zIndex);if(c(r,l(t,i)))return r},createIframe:a,setFullSizeStyle:o,simpleTemplate:l,setIframeContent:c,extend:function(e,t){return Object.keys(t).forEach((function(i){e[i]=t[i]})),e},unique:function(e){var t=-1;return function(){return e+"_"+ ++t}}}},function(e,t,i){"use strict";var r=i(1),s=r.unique("vpaidIframe"),n=i(4);function a(e,t,i,n){i=i||{},this._id=s(),this._destroyed=!1,this._frameContainer=r.createElementInEl(e,"div"),this._videoEl=t,this._vpaidOptions=n||{timeout:1e4},this._templateConfig={template:i.template||'<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"></head><body style="margin:0;padding:0"><div class="ad-element"></div><script type="text/javascript" src="{{iframeURL_JS}}"><\/script><script type="text/javascript">window.parent.postMessage(\'{"event": "ready", "id": "{{iframeID}}"}\', \'{{origin}}\');<\/script></body></html>',extraOptions:i.extraOptions||{}}}function o(e){var t=this[e];t&&(t.remove(),delete this[e])}function l(){h.call(this),delete this._adUnit}function c(){h.call(this),u.call(this)}function h(){o.call(this,"_frame"),p.call(this)}function p(){this._onLoad&&(window.removeEventListener("message",this._onLoad),r.clearCallbackTimeout(this._onLoad),delete this._onLoad)}function u(){this._adUnit&&(this._adUnit.stopAd(),delete this._adUnit)}function d(){if(this._destroyed)throw new Error("VPAIDHTML5Client already destroyed!")}function m(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}a.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,c.call(this))},a.prototype.isDestroyed=function(){return this._destroyed},a.prototype.loadAdUnit=function(e,t){d.call(this),c.call(this);var i=this,s=r.createIframeWithContent(this._frameContainer,this._templateConfig.template,r.extend({iframeURL_JS:e,iframeID:this.getID(),origin:m()},this._templateConfig.extraOptions));this._frame=s,this._onLoad=r.callbackTimeout(this._vpaidOptions.timeout,function(e){if(e.origin!==m())return;var s,a,o;if(JSON.parse(e.data).id!==i.getID())return;i._frame.contentWindow?(o=i._frame.contentWindow.getVPAIDAd,a=r.validate("function"==typeof o,"the ad didn't return a function to create an ad")):a="the iframe is not anymore in the DOM tree";if(!a){var c=i._frame.contentWindow.document.querySelector(".ad-element");(s=new n(o(),c,i._videoEl,i._frame)).subscribe("AdStopped",l.bind(i)),a=r.validate(s.isValidVPAIDAd(),"the add is not fully complaint with VPAID specification")}return i._adUnit=s,p.call(i),t(a,a?null:s),!0}.bind(this),function(){t("timeout",null)}.bind(this)),window.addEventListener("message",this._onLoad)},a.prototype.unloadAdUnit=function(){c.call(this)},a.prototype.getID=function(){return this._id},e.exports=a},function(e,t,i){i(8),e.exports=i(7)},function(e,t,i){"use strict";var r=i(5),s=i(6),n=r.checkVPAIDInterface,a=i(1),o=(r.METHODS,r.EVENTS.filter((function(e){return"AdClickThru"!=e})));function l(e,t,i,r){this._isValid=n(e),this._isValid&&(this._creative=e,this._el=t,this._videoEl=i,this._iframe=r,this._subscribers=new s,a.setFullSizeStyle(t),c.call(this))}function c(){if(o.forEach(function(e){this._creative.subscribe(p.bind(this,e),e)}.bind(this)),this._creative.subscribe(h.bind(this),"AdClickThru"),this._videoEl){var e=this._iframe.contentDocument.documentElement,t=this._videoEl;e.addEventListener("click",(function(i){i.target===e&&t.click()}))}}function h(e,t,i){this._subscribers.triggerSync("AdClickThru",{url:e,id:t,playerHandles:i})}function p(e){this._subscribers.trigger(e,Array.prototype.slice(arguments,1))}function u(e,t,i,r){e?e(i,r):i&&t.trigger("AdError",i)}l.prototype=Object.create(r.prototype),l.prototype.isValidVPAIDAd=function(){return this._isValid},r.METHODS.forEach((function(e){-1===["subscribe","unsubscribe","initAd"].indexOf(e)&&(l.prototype[e]=function(){var t=r.prototype[e].length,i=Array.prototype.slice.call(arguments),s=t===i.length?i.pop():void 0;setTimeout(function(){var t,r=null;try{t=this._creative[e].apply(this._creative,i)}catch(e){r=e}u(s,this._subscribers,r,t)}.bind(this),0)})})),l.prototype.initAd=function(e,t,i,r,s,n,o){s=s||{},n=a.extend({slot:this._el,videoSlot:this._videoEl},n||{}),setTimeout(function(){var a;try{this._creative.initAd(e,t,i,r,s,n)}catch(e){a=e}u(o,this._subscribers,a)}.bind(this),0)},l.prototype.subscribe=function(e,t,i){this._subscribers.subscribe(t,e,i)},l.prototype.unsubscribe=function(e,t){this._subscribers.unsubscribe(t,e)},l.prototype.on=l.prototype.subscribe,l.prototype.off=l.prototype.unsubscribe,r.GETTERS.forEach((function(e){l.prototype[e]=function(t){setTimeout(function(){var i,r=null;try{i=this._creative[e]()}catch(e){r=e}u(t,this._subscribers,r,i)}.bind(this),0)}})),l.prototype.setAdVolume=function(e,t){setTimeout(function(){var i,r=null;try{this._creative.setAdVolume(e),i=this._creative.getAdVolume()}catch(e){r=e}r||(r=a.validate(i===e,"failed to apply volume: "+e)),u(t,this._subscribers,r,i)}.bind(this),0)},l.prototype._destroy=function(){this.stopAd(),this._subscribers.unsubscribeAll()},e.exports=l},function(e,t,i){"use strict";var r=["handshakeVersion","initAd","startAd","stopAd","skipAd","resizeAd","pauseAd","resumeAd","expandAd","collapseAd","subscribe","unsubscribe"];function s(e,t,i){}s.prototype.handshakeVersion=function(e,t){},s.prototype.initAd=function(e,t,i,r,s,n,a){},s.prototype.startAd=function(e){},s.prototype.stopAd=function(e){},s.prototype.skipAd=function(e){},s.prototype.resizeAd=function(e,t,i,r){},s.prototype.pauseAd=function(e){},s.prototype.resumeAd=function(e){},s.prototype.expandAd=function(e){},s.prototype.collapseAd=function(e){},s.prototype.subscribe=function(e,t,i){},s.prototype.unsubscribe=function(e,t){},s.prototype.getAdLinear=function(e){},s.prototype.getAdWidth=function(e){},s.prototype.getAdHeight=function(e){},s.prototype.getAdExpanded=function(e){},s.prototype.getAdSkippableState=function(e){},s.prototype.getAdRemainingTime=function(e){},s.prototype.getAdDuration=function(e){},s.prototype.getAdVolume=function(e){},s.prototype.getAdCompanions=function(e){},s.prototype.getAdIcons=function(e){},s.prototype.setAdVolume=function(e,t){},a(s,"METHODS",r),a(s,"GETTERS",["getAdLinear","getAdWidth","getAdHeight","getAdExpanded","getAdSkippableState","getAdRemainingTime","getAdDuration","getAdVolume","getAdCompanions","getAdIcons"]),a(s,"SETTERS",["setAdVolume"]),a(s,"EVENTS",["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"]);var n=r.filter((function(e){return-1===["skipAd"].indexOf(e)}));function a(e,t,i){Object.defineProperty(e,t,{writable:!1,configurable:!1,value:i})}a(s,"checkVPAIDInterface",(function(e){return n.every((function(t){return"function"==typeof e[t]}))})),e.exports=s},function(e,t,i){"use strict";function r(){this._subscribers={}}r.prototype.subscribe=function(e,t,i){this.isHandlerAttached(e,t)||this.get(t).push({handler:e,context:i,eventName:t})},r.prototype.unsubscribe=function(e,t){this._subscribers[t]=this.get(t).filter((function(t){return e!==t.handler}))},r.prototype.unsubscribeAll=function(){this._subscribers={}},r.prototype.trigger=function(e,t){var i=this;this.get(e).concat(this.get("*")).forEach((function(e){setTimeout((function(){i.isHandlerAttached(e.handler,e.eventName)&&e.handler.call(e.context,t)}),0)}))},r.prototype.triggerSync=function(e,t){this.get(e).concat(this.get("*")).forEach((function(e){e.handler.call(e.context,t)}))},r.prototype.get=function(e){return this._subscribers[e]||(this._subscribers[e]=[]),this._subscribers[e]},r.prototype.isHandlerAttached=function(e,t){return this.get(t).some((function(t){return e===t.handler}))},e.exports=r},function(e,t,i){},function(e,t,i){"use strict";i.r(t);var r=i(0),s=i.n(r);class n{constructor(){this.id=null,this.sequence=null,this.system=null,this.title=null,this.description=null,this.advertiser=null,this.pricing=null,this.survey=null,this.errorURLTemplates=[],this.impressionURLTemplates=[],this.creatives=[],this.extensions=[]}}class a{constructor(){this.attributes={},this.children=[]}}class o{constructor(){this.name=null,this.value=null,this.attributes={}}}class l{constructor(){this.id=null,this.width=0,this.height=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.altText=null,this.companionClickThroughURLTemplate=null,this.companionClickTrackingURLTemplates=[],this.trackingEvents={}}}class c{constructor(e={}){this.id=e.id||null,this.adId=e.adId||null,this.sequence=e.sequence||null,this.apiFramework=e.apiFramework||null,this.trackingEvents={}}}class h extends c{constructor(e={}){super(e),this.type="companion",this.variations=[]}}class p{track(e,t){this.resolveURLTemplates(e,t).forEach(e=>{"undefined"!=typeof window&&null!==window&&((new Image).src=e)})}resolveURLTemplates(e,t={}){const i=[];t.ASSETURI&&(t.ASSETURI=this.encodeURIComponentRFC3986(t.ASSETURI)),t.CONTENTPLAYHEAD&&(t.CONTENTPLAYHEAD=this.encodeURIComponentRFC3986(t.CONTENTPLAYHEAD)),t.ERRORCODE&&!/^[0-9]{3}$/.test(t.ERRORCODE)&&(t.ERRORCODE=900),t.CACHEBUSTING=this.leftpad(Math.round(1e8*Math.random()).toString()),t.TIMESTAMP=this.encodeURIComponentRFC3986((new Date).toISOString()),t.RANDOM=t.random=t.CACHEBUSTING;for(let r in e){let s=e[r];if(s){for(let e in t){const i=t[e],r=`[${e}]`,n=`%%${e}%%`;s=(s=s.replace(r,i)).replace(n,i)}i.push(s)}}return i}encodeURIComponentRFC3986(e){return encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16)}`)}leftpad(e){return e.length<8?this.range(0,8-e.length,!1).map(e=>"0").join("")+e:e}range(e,t,i){let r=[],s=e<t,n=i?s?t+1:t-1:t;for(let t=e;s?t<n:t>n;s?t++:t--)r.push(t);return r}isNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)}flatten(e){return e.reduce((e,t)=>e.concat(Array.isArray(t)?this.flatten(t):t),[])}}class u{constructor(){this.util=new p}childByName(e,t){const i=e.childNodes;for(let e in i){const r=i[e];if(r.nodeName===t)return r}}childrenByName(e,t){const i=[],r=e.childNodes;for(let e in r){const s=r[e];s.nodeName===t&&i.push(s)}return i}resolveVastAdTagURI(e,t){if(!t)return e;if(0===e.indexOf("//")){const{protocol:t}=location;return`${t}${e}`}return-1===e.indexOf("://")?`${t.slice(0,t.lastIndexOf("/"))}/${e}`:e}parseBoolean(e){return-1!==["true","TRUE","1"].indexOf(e)}parseNodeText(e){return e&&(e.textContent||e.text||"").trim()}copyNodeAttribute(e,t,i){const r=t.getAttribute(e);r&&i.setAttribute(e,r)}parseDuration(e){if(null==e)return-1;if(this.util.isNumeric(e))return parseInt(e);const t=e.split(":");if(3!==t.length)return-1;const i=t[2].split(".");let r=parseInt(i[0]);2===i.length&&(r+=parseFloat(`0.${i[1]}`));const s=parseInt(60*t[1]),n=parseInt(60*t[0]*60);return isNaN(n)||isNaN(s)||isNaN(r)||s>3600||r>60?-1:n+s+r}splitVAST(e){const t=[];let i=null;return e.forEach((r,s)=>{if(r.sequence&&(r.sequence=parseInt(r.sequence,10)),r.sequence>1){const t=e[s-1];if(t&&t.sequence===r.sequence-1)return void(i&&i.push(r));delete r.sequence}i=[r],t.push(i)}),t}}class d{constructor(){this.parserUtils=new u}parse(e,t){const i=new h(t);return this.parserUtils.childrenByName(e,"Companion").forEach(e=>{const t=new l;t.id=e.getAttribute("id")||null,t.width=e.getAttribute("width"),t.height=e.getAttribute("height"),t.companionClickTrackingURLTemplates=[],this.parserUtils.childrenByName(e,"HTMLResource").forEach(e=>{t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=this.parserUtils.parseNodeText(e)}),this.parserUtils.childrenByName(e,"IFrameResource").forEach(e=>{t.type=e.getAttribute("creativeType")||0,t.iframeResource=this.parserUtils.parseNodeText(e)}),this.parserUtils.childrenByName(e,"StaticResource").forEach(i=>{t.type=i.getAttribute("creativeType")||0,this.parserUtils.childrenByName(e,"AltText").forEach(e=>{t.altText=this.parserUtils.parseNodeText(e)}),t.staticResource=this.parserUtils.parseNodeText(i)}),this.parserUtils.childrenByName(e,"TrackingEvents").forEach(e=>{this.parserUtils.childrenByName(e,"Tracking").forEach(e=>{const i=e.getAttribute("event"),r=this.parserUtils.parseNodeText(e);i&&r&&(null==t.trackingEvents[i]&&(t.trackingEvents[i]=[]),t.trackingEvents[i].push(r))})}),this.parserUtils.childrenByName(e,"CompanionClickTracking").forEach(e=>{t.companionClickTrackingURLTemplates.push(this.parserUtils.parseNodeText(e))}),t.companionClickThroughURLTemplate=this.parserUtils.parseNodeText(this.parserUtils.childByName(e,"CompanionClickThrough")),t.companionClickTrackingURLTemplate=this.parserUtils.parseNodeText(this.parserUtils.childByName(e,"CompanionClickTracking")),i.variations.push(t)}),i}}class m extends c{constructor(e={}){super(e),this.type="linear",this.duration=0,this.skipDelay=null,this.mediaFiles=[],this.videoClickThroughURLTemplate=null,this.videoClickTrackingURLTemplates=[],this.videoCustomClickURLTemplates=[],this.adParameters=null,this.icons=[]}}class f{constructor(){this.program=null,this.height=0,this.width=0,this.xPosition=0,this.yPosition=0,this.apiFramework=null,this.offset=null,this.duration=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.iconClickThroughURLTemplate=null,this.iconClickTrackingURLTemplates=[],this.iconViewTrackingURLTemplate=null}}class g{constructor(){this.id=null,this.fileURL=null,this.deliveryType="progressive",this.mimeType=null,this.codec=null,this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.width=0,this.height=0,this.apiFramework=null,this.scalable=null,this.maintainAspectRatio=null}}class v{constructor(){this.parserUtils=new u}parse(e,t){let i;const r=new m(t);r.duration=this.parserUtils.parseDuration(this.parserUtils.parseNodeText(this.parserUtils.childByName(e,"Duration")));const s=e.getAttribute("skipoffset");if(null==s)r.skipDelay=null;else if("%"===s.charAt(s.length-1)&&-1!==r.duration){const e=parseInt(s,10);r.skipDelay=r.duration*(e/100)}else r.skipDelay=this.parserUtils.parseDuration(s);const n=this.parserUtils.childByName(e,"VideoClicks");n&&(r.videoClickThroughURLTemplate=this.parserUtils.parseNodeText(this.parserUtils.childByName(n,"ClickThrough")),this.parserUtils.childrenByName(n,"ClickTracking").forEach(e=>{r.videoClickTrackingURLTemplates.push(this.parserUtils.parseNodeText(e))}),this.parserUtils.childrenByName(n,"CustomClick").forEach(e=>{r.videoCustomClickURLTemplates.push(this.parserUtils.parseNodeText(e))}));const a=this.parserUtils.childByName(e,"AdParameters");a&&(r.adParameters=this.parserUtils.parseNodeText(a)),this.parserUtils.childrenByName(e,"TrackingEvents").forEach(e=>{this.parserUtils.childrenByName(e,"Tracking").forEach(e=>{let t=e.getAttribute("event");const s=this.parserUtils.parseNodeText(e);if(t&&s){if("progress"===t){if(!(i=e.getAttribute("offset")))return;t="%"===i.charAt(i.length-1)?`progress-${i}`:`progress-${Math.round(this.parserUtils.parseDuration(i))}`}null==r.trackingEvents[t]&&(r.trackingEvents[t]=[]),r.trackingEvents[t].push(s)}})}),this.parserUtils.childrenByName(e,"MediaFiles").forEach(e=>{this.parserUtils.childrenByName(e,"MediaFile").forEach(e=>{const t=new g;t.id=e.getAttribute("id"),t.fileURL=this.parserUtils.parseNodeText(e),t.deliveryType=e.getAttribute("delivery"),t.codec=e.getAttribute("codec"),t.mimeType=e.getAttribute("type"),t.apiFramework=e.getAttribute("apiFramework"),t.bitrate=parseInt(e.getAttribute("bitrate")||0),t.minBitrate=parseInt(e.getAttribute("minBitrate")||0),t.maxBitrate=parseInt(e.getAttribute("maxBitrate")||0),t.width=parseInt(e.getAttribute("width")||0),t.height=parseInt(e.getAttribute("height")||0);let i=e.getAttribute("scalable");i&&"string"==typeof i&&("true"===(i=i.toLowerCase())?t.scalable=!0:"false"===i&&(t.scalable=!1));let s=e.getAttribute("maintainAspectRatio");s&&"string"==typeof s&&("true"===(s=s.toLowerCase())?t.maintainAspectRatio=!0:"false"===s&&(t.maintainAspectRatio=!1)),r.mediaFiles.push(t)})});const o=this.parserUtils.childByName(e,"Icons");return o&&this.parserUtils.childrenByName(o,"Icon").forEach(e=>{const t=new f;t.program=e.getAttribute("program"),t.height=parseInt(e.getAttribute("height")||0),t.width=parseInt(e.getAttribute("width")||0),t.xPosition=this.parseXPosition(e.getAttribute("xPosition")),t.yPosition=this.parseYPosition(e.getAttribute("yPosition")),t.apiFramework=e.getAttribute("apiFramework"),t.offset=this.parserUtils.parseDuration(e.getAttribute("offset")),t.duration=this.parserUtils.parseDuration(e.getAttribute("duration")),this.parserUtils.childrenByName(e,"HTMLResource").forEach(e=>{t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=this.parserUtils.parseNodeText(e)}),this.parserUtils.childrenByName(e,"IFrameResource").forEach(e=>{t.type=e.getAttribute("creativeType")||0,t.iframeResource=this.parserUtils.parseNodeText(e)}),this.parserUtils.childrenByName(e,"StaticResource").forEach(e=>{t.type=e.getAttribute("creativeType")||0,t.staticResource=this.parserUtils.parseNodeText(e)});const i=this.parserUtils.childByName(e,"IconClicks");i&&(t.iconClickThroughURLTemplate=this.parserUtils.parseNodeText(this.parserUtils.childByName(i,"IconClickThrough")),this.parserUtils.childrenByName(i,"IconClickTracking").forEach(e=>{t.iconClickTrackingURLTemplates.push(this.parserUtils.parseNodeText(e))})),t.iconViewTrackingURLTemplate=this.parserUtils.parseNodeText(this.parserUtils.childByName(e,"IconViewTracking")),r.icons.push(t)}),r}parseXPosition(e){return-1!==["left","right"].indexOf(e)?e:parseInt(e||0)}parseYPosition(e){return-1!==["top","bottom"].indexOf(e)?e:parseInt(e||0)}}class T extends c{constructor(e={}){super(e),this.type="nonlinear",this.variations=[]}}class y{constructor(){this.id=null,this.width=0,this.height=0,this.expandedWidth=0,this.expandedHeight=0,this.scalable=!0,this.maintainAspectRatio=!0,this.minSuggestedDuration=0,this.apiFramework="static",this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.nonlinearClickThroughURLTemplate=null,this.nonlinearClickTrackingURLTemplates=[],this.adParameters=null}}class k{constructor(){this.parserUtils=new u}parse(e,t){const i=new T(t);return this.parserUtils.childrenByName(e,"TrackingEvents").forEach(e=>{let t,r;this.parserUtils.childrenByName(e,"Tracking").forEach(e=>{t=e.getAttribute("event"),r=this.parserUtils.parseNodeText(e),t&&r&&(null==i.trackingEvents[t]&&(i.trackingEvents[t]=[]),i.trackingEvents[t].push(r))})}),this.parserUtils.childrenByName(e,"NonLinear").forEach(e=>{const t=new y;t.id=e.getAttribute("id")||null,t.width=e.getAttribute("width"),t.height=e.getAttribute("height"),t.expandedWidth=e.getAttribute("expandedWidth"),t.expandedHeight=e.getAttribute("expandedHeight"),t.scalable=this.parserUtils.parseBoolean(e.getAttribute("scalable")),t.maintainAspectRatio=this.parserUtils.parseBoolean(e.getAttribute("maintainAspectRatio")),t.minSuggestedDuration=this.parserUtils.parseDuration(e.getAttribute("minSuggestedDuration")),t.apiFramework=e.getAttribute("apiFramework"),this.parserUtils.childrenByName(e,"HTMLResource").forEach(e=>{t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=this.parserUtils.parseNodeText(e)}),this.parserUtils.childrenByName(e,"IFrameResource").forEach(e=>{t.type=e.getAttribute("creativeType")||0,t.iframeResource=this.parserUtils.parseNodeText(e)}),this.parserUtils.childrenByName(e,"StaticResource").forEach(e=>{t.type=e.getAttribute("creativeType")||0,t.staticResource=this.parserUtils.parseNodeText(e)});const r=this.parserUtils.childByName(e,"AdParameters");r&&(t.adParameters=this.parserUtils.parseNodeText(r)),t.nonlinearClickThroughURLTemplate=this.parserUtils.parseNodeText(this.parserUtils.childByName(e,"NonLinearClickThrough")),this.parserUtils.childrenByName(e,"NonLinearClickTracking").forEach(e=>{t.nonlinearClickTrackingURLTemplates.push(this.parserUtils.parseNodeText(e))}),i.variations.push(t)}),i}}class A{constructor(){this.creativeCompanionParser=new d,this.creativeNonLinearParser=new k,this.creativeLinearParser=new v,this.parserUtils=new u}parse(e){const t=e.childNodes;for(let i in t){const r=t[i];if(-1!==["Wrapper","InLine"].indexOf(r.nodeName)){if(this.parserUtils.copyNodeAttribute("id",e,r),this.parserUtils.copyNodeAttribute("sequence",e,r),"Wrapper"===r.nodeName)return this.parseWrapper(r);if("InLine"===r.nodeName)return this.parseInLine(r)}}}parseInLine(e){const t=e.childNodes,i=new n;i.id=e.getAttribute("id")||null,i.sequence=e.getAttribute("sequence")||null;for(let e in t){const r=t[e];switch(r.nodeName){case"Error":i.errorURLTemplates.push(this.parserUtils.parseNodeText(r));break;case"Impression":i.impressionURLTemplates.push(this.parserUtils.parseNodeText(r));break;case"Creatives":this.parserUtils.childrenByName(r,"Creative").forEach(e=>{const t={id:e.getAttribute("id")||null,adId:this.parseCreativeAdIdAttribute(e),sequence:e.getAttribute("sequence")||null,apiFramework:e.getAttribute("apiFramework")||null};for(let r in e.childNodes){const s=e.childNodes[r];switch(s.nodeName){case"Linear":let e=this.creativeLinearParser.parse(s,t);e&&i.creatives.push(e);break;case"NonLinearAds":let r=this.creativeNonLinearParser.parse(s,t);r&&i.creatives.push(r);break;case"CompanionAds":let n=this.creativeCompanionParser.parse(s,t);n&&i.creatives.push(n)}}});break;case"Extensions":this.parseExtensions(i.extensions,this.parserUtils.childrenByName(r,"Extension"));break;case"AdSystem":i.system={value:this.parserUtils.parseNodeText(r),version:r.getAttribute("version")||null};break;case"AdTitle":i.title=this.parserUtils.parseNodeText(r);break;case"Description":i.description=this.parserUtils.parseNodeText(r);break;case"Advertiser":i.advertiser=this.parserUtils.parseNodeText(r);break;case"Pricing":i.pricing={value:this.parserUtils.parseNodeText(r),model:r.getAttribute("model")||null,currency:r.getAttribute("currency")||null};break;case"Survey":i.survey=this.parserUtils.parseNodeText(r)}}return i}parseWrapper(e){const t=this.parseInLine(e);let i=this.parserUtils.childByName(e,"VASTAdTagURI");if(i?t.nextWrapperURL=this.parserUtils.parseNodeText(i):(i=this.parserUtils.childByName(e,"VASTAdTagURL"))&&(t.nextWrapperURL=this.parserUtils.parseNodeText(this.parserUtils.childByName(i,"URL"))),t.creatives.forEach(e=>{if(-1!==["linear","nonlinear"].indexOf(e.type)){if(e.trackingEvents){t.trackingEvents||(t.trackingEvents={}),t.trackingEvents[e.type]||(t.trackingEvents[e.type]={});for(let i in e.trackingEvents){const r=e.trackingEvents[i];t.trackingEvents[e.type][i]||(t.trackingEvents[e.type][i]=[]),r.forEach(r=>{t.trackingEvents[e.type][i].push(r)})}}e.videoClickTrackingURLTemplates&&(t.videoClickTrackingURLTemplates||(t.videoClickTrackingURLTemplates=[]),e.videoClickTrackingURLTemplates.forEach(e=>{t.videoClickTrackingURLTemplates.push(e)})),e.videoClickThroughURLTemplate&&(t.videoClickThroughURLTemplate=e.videoClickThroughURLTemplate),e.videoCustomClickURLTemplates&&(t.videoCustomClickURLTemplates||(t.videoCustomClickURLTemplates=[]),e.videoCustomClickURLTemplates.forEach(e=>{t.videoCustomClickURLTemplates.push(e)}))}}),t.nextWrapperURL)return t}parseExtensions(e,t){t.forEach(t=>{const i=new a,r=t.attributes,s=t.childNodes;if(t.attributes)for(let e in r){const t=r[e];t.nodeName&&t.nodeValue&&(i.attributes[t.nodeName]=t.nodeValue)}for(let e in s){const t=s[e],r=this.parserUtils.parseNodeText(t);if("#comment"!==t.nodeName&&""!==r){const e=new o;if(e.name=t.nodeName,e.value=r,t.attributes){const i=t.attributes;for(let t in i){const r=i[t];e.attributes[r.nodeName]=r.nodeValue}}i.children.push(e)}}e.push(i)})}parseCreativeAdIdAttribute(e){return e.getAttribute("AdID")||e.getAttribute("adID")||e.getAttribute("adId")||null}}function U(){}function b(){b.init.call(this)}function R(e){return void 0===e._maxListeners?b.defaultMaxListeners:e._maxListeners}function L(e,t,i){if(t)e.call(i);else for(var r=e.length,s=I(e,r),n=0;n<r;++n)s[n].call(i)}function w(e,t,i,r){if(t)e.call(i,r);else for(var s=e.length,n=I(e,s),a=0;a<s;++a)n[a].call(i,r)}function E(e,t,i,r,s){if(t)e.call(i,r,s);else for(var n=e.length,a=I(e,n),o=0;o<n;++o)a[o].call(i,r,s)}function C(e,t,i,r,s,n){if(t)e.call(i,r,s,n);else for(var a=e.length,o=I(e,a),l=0;l<a;++l)o[l].call(i,r,s,n)}function x(e,t,i,r){if(t)e.apply(i,r);else for(var s=e.length,n=I(e,s),a=0;a<s;++a)n[a].apply(i,r)}function N(e,t,i,r){var s,n,a;if("function"!=typeof i)throw new TypeError('"listener" argument must be a function');if((n=e._events)?(n.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),n=e._events),a=n[t]):(n=e._events=new U,e._eventsCount=0),a){if("function"==typeof a?a=n[t]=r?[i,a]:[a,i]:r?a.unshift(i):a.push(i),!a.warned&&(s=R(e))&&s>0&&a.length>s){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=t,o.count=a.length,function(e){"function"==typeof console.warn?console.warn(e):console.log(e)}(o)}}else a=n[t]=i,++e._eventsCount;return e}function _(e,t,i){var r=!1;function s(){e.removeListener(t,s),r||(r=!0,i.apply(e,arguments))}return s.listener=i,s}function S(e){var t=this._events;if(t){var i=t[e];if("function"==typeof i)return 1;if(i)return i.length}return 0}function I(e,t){for(var i=new Array(t);t--;)i[t]=e[t];return i}U.prototype=Object.create(null),b.EventEmitter=b,b.usingDomains=!1,b.prototype.domain=void 0,b.prototype._events=void 0,b.prototype._maxListeners=void 0,b.defaultMaxListeners=10,b.init=function(){this.domain=null,b.usingDomains&&(!(void 0).active||this instanceof(void 0).Domain||(this.domain=(void 0).active)),this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new U,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},b.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},b.prototype.getMaxListeners=function(){return R(this)},b.prototype.emit=function(e){var t,i,r,s,n,a,o,l="error"===e;if(a=this._events)l=l&&null==a.error;else if(!l)return!1;if(o=this.domain,l){if(t=arguments[1],!o){if(t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=o,t.domainThrown=!1,o.emit("error",t),!1}if(!(i=a[e]))return!1;var h="function"==typeof i;switch(r=arguments.length){case 1:L(i,h,this);break;case 2:w(i,h,this,arguments[1]);break;case 3:E(i,h,this,arguments[1],arguments[2]);break;case 4:C(i,h,this,arguments[1],arguments[2],arguments[3]);break;default:for(s=new Array(r-1),n=1;n<r;n++)s[n-1]=arguments[n];x(i,h,this,s)}return!0},b.prototype.addListener=function(e,t){return N(this,e,t,!1)},b.prototype.on=b.prototype.addListener,b.prototype.prependListener=function(e,t){return N(this,e,t,!0)},b.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,_(this,e,t)),this},b.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,_(this,e,t)),this},b.prototype.removeListener=function(e,t){var i,r,s,n,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(r=this._events))return this;if(!(i=r[e]))return this;if(i===t||i.listener&&i.listener===t)0==--this._eventsCount?this._events=new U:(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(s=-1,n=i.length;n-- >0;)if(i[n]===t||i[n].listener&&i[n].listener===t){a=i[n].listener,s=n;break}if(s<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events=new U,this;delete r[e]}else!function(e,t){for(var i=t,r=i+1,s=e.length;r<s;i+=1,r+=1)e[i]=e[r];e.pop()}(i,s);r.removeListener&&this.emit("removeListener",e,a||t)}return this},b.prototype.removeAllListeners=function(e){var t,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events=new U,this._eventsCount=0):i[e]&&(0==--this._eventsCount?this._events=new U:delete i[e]),this;if(0===arguments.length){for(var r,s=Object.keys(i),n=0;n<s.length;++n)"removeListener"!==(r=s[n])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=new U,this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},b.prototype.listeners=function(e){var t,i=this._events;return i&&(t=i[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(t):[]},b.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):S.call(e,t)},b.prototype.listenerCount=S,b.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};class D{xdr(){let e;return window.XDomainRequest&&(e=new XDomainRequest),e}supported(){return!!this.xdr()}get(e,t,i){let r="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0;if(!r)return i(new Error("FlashURLHandler: Microsoft.XMLDOM format not supported"));r.async=!1;const s=this.xdr();s.open("GET",e),s.timeout=t.timeout||0,s.withCredentials=t.withCredentials||!1,s.send(),s.onprogress=function(){},s.onload=function(){r.loadXML(s.responseText),i(null,r)}}}class P{get(e,t,i){i(new Error("Please bundle the library for node to use the node urlHandler"))}}class O{xhr(){try{const e=new window.XMLHttpRequest;return"withCredentials"in e?e:null}catch(e){return console.log("Error in XHRURLHandler support check:",e),null}}supported(){return!!this.xhr()}get(e,t,i){if("https:"===window.location.protocol&&0===e.indexOf("http://"))return i(new Error("XHRURLHandler: Cannot go from HTTPS to HTTP."));try{const r=this.xhr();r.open("GET",e),r.timeout=t.timeout||0,r.withCredentials=t.withCredentials||!1,r.overrideMimeType&&r.overrideMimeType("text/xml"),r.onreadystatechange=function(){4===r.readyState&&(200===r.status?i(null,r.responseXML):i(new Error(`XHRURLHandler: ${r.statusText}`)))},r.send()}catch(e){i(new Error("XHRURLHandler: Unexpected error"))}}}class V{constructor(){this.flash=new D,this.node=new P,this.xhr=new O}get(e,t,i){return i||("function"==typeof t&&(i=t),t={}),t.urlhandler&&t.urlhandler.supported()?t.urlhandler.get(e,t,i):"undefined"==typeof window||null===window?this.node.get(e,t,i):this.xhr.supported()?this.xhr.get(e,t,i):this.flash.supported()?this.flash.get(e,t,i):i(new Error("Current context is not supported by any of the default URLHandlers. Please provide a custom URLHandler"))}}class B{constructor(){this.ads=[],this.errorURLTemplates=[]}}const M={ERRORCODE:900,extensions:[]};class F extends b{constructor(){super(),this.remainingAds=[],this.parentURLs=[],this.errorURLTemplates=[],this.rootErrorURLTemplates=[],this.maxWrapperDepth=null,this.URLTemplateFilters=[],this.fetchingOptions={},this.parserUtils=new u,this.adParser=new A,this.util=new p}addURLTemplateFilter(e){"function"==typeof e&&this.URLTemplateFilters.push(e)}removeURLTemplateFilter(){this.URLTemplateFilters.pop()}countURLTemplateFilters(){return this.URLTemplateFilters.length}clearURLTemplateFilters(){this.URLTemplateFilters=[]}trackVastError(e,t,...i){this.emit("VAST-error",Object.assign(M,t,...i)),this.util.track(e,t)}getErrorURLTemplates(){return this.rootErrorURLTemplates.concat(this.errorURLTemplates)}fetchVAST(e){return new Promise((t,i)=>{this.URLTemplateFilters.forEach(t=>{e=t(e)}),this.parentURLs.push(e),this.emit("VAST-resolving",{url:e}),this.urlHandler.get(e,this.fetchingOptions,(r,s)=>{this.emit("VAST-resolved",{url:e}),r?i(r):t(s)})})}initParsingStatus(e={}){this.rootURL="",this.remainingAds=[],this.parentURLs=[],this.errorURLTemplates=[],this.rootErrorURLTemplates=[],this.maxWrapperDepth=e.wrapperLimit||10,this.fetchingOptions={timeout:e.timeout,withCredentials:e.withCredentials},this.urlHandler=e.urlhandler||new V}getRemainingAds(e){return new Promise((t,i)=>{if(0===this.remainingAds.length)return i(new Error("No more ads are available for the given VAST"));const r=e?this.util.flatten(this.remainingAds):this.remainingAds.shift();this.errorURLTemplates=[],this.parentURLs=[],this.resolveAds(r,{wrapperDepth:0,originalUrl:this.rootURL}).then(e=>{const i=this.buildVASTResponse(e);t(i)}).catch(e=>i(e))})}getAndParseVAST(e,t={}){return this.initParsingStatus(t),this.rootURL=e,new Promise((i,r)=>{this.fetchVAST(e).then(s=>{t.originalUrl=e,t.isRootVAST=!0,this.parse(s,t).then(e=>{const t=this.buildVASTResponse(e);i(t)}).catch(e=>r(e))}).catch(e=>r(e))})}parseVAST(e,t={}){return this.initParsingStatus(t),new Promise((i,r)=>{t.isRootVAST=!0,this.parse(e,t).then(e=>{const t=this.buildVASTResponse(e);i(t)}).catch(e=>r(e))})}buildVASTResponse(e){const t=new B;return t.ads=e,t.errorURLTemplates=this.getErrorURLTemplates(),this.completeWrapperResolving(t),t}parse(e,{resolveAll:t=!0,wrapperSequence:i=null,originalUrl:r=null,wrapperDepth:s=0,isRootVAST:n=!1}){return new Promise((a,o)=>{if(!e||!e.documentElement||"VAST"!==e.documentElement.nodeName)return o(new Error("Invalid VAST XMLDocument"));let l=[];const c=e.documentElement.childNodes;for(let e in c){const t=c[e];if("Error"===t.nodeName){const e=this.parserUtils.parseNodeText(t);n?this.rootErrorURLTemplates.push(e):this.errorURLTemplates.push(e)}if("Ad"===t.nodeName){const e=this.adParser.parse(t);e?l.push(e):this.trackVastError(this.getErrorURLTemplates(),{ERRORCODE:101})}}const h=l.length,p=l[h-1];1===h&&null!=i&&p&&!p.sequence&&(p.sequence=i),!1===t&&(this.remainingAds=this.parserUtils.splitVAST(l),l=this.remainingAds.shift()),this.resolveAds(l,{resolveAll:t,wrapperDepth:s,originalUrl:r}).then(e=>a(e)).catch(e=>o(e))})}resolveAds(e=[],{wrapperDepth:t,originalUrl:i}){return new Promise((r,s)=>{const n=[];e.forEach(e=>{const r=this.resolveWrappers(e,t,i);n.push(r)}),r(Promise.all(n).then(e=>this.util.flatten(e)))}).then(e=>{if(!e&&this.remainingAds.length>0){const e=this.remainingAds.shift();return this.resolveAds(e,{wrapperDepth:t,originalUrl:i})}return e})}resolveWrappers(e,t,i){return new Promise((r,s)=>{if(t++,!e.nextWrapperURL)return delete e.nextWrapperURL,r(e);if(t>=this.maxWrapperDepth||-1!==this.parentURLs.indexOf(e.nextWrapperURL))return e.errorCode=302,delete e.nextWrapperURL,r(e);e.nextWrapperURL=this.parserUtils.resolveVastAdTagURI(e.nextWrapperURL,i);const n=e.sequence;i=e.nextWrapperURL,this.fetchVAST(e.nextWrapperURL).then(s=>{this.parse(s,{originalUrl:i,wrapperSequence:n,wrapperDepth:t}).then(t=>{if(delete e.nextWrapperURL,0===t.length)return e.creatives=[],r(e);t.forEach(t=>{t&&this.mergeWrapperAdData(t,e)}),r(t)}).catch(t=>{e.errorCode=301,e.errorMessage=t.message,r(e)})}).catch(e=>s(e))})}completeWrapperResolving(e){if(0===e.ads.length)this.trackVastError(e.errorURLTemplates,{ERRORCODE:303});else for(let t=e.ads.length-1;t>=0;t--){let i=e.ads[t];(i.errorCode||0===i.creatives.length)&&(this.trackVastError(i.errorURLTemplates.concat(e.errorURLTemplates),{ERRORCODE:i.errorCode||303},{ERRORMESSAGE:i.errorMessage||""},{extensions:i.extensions},{system:i.system}),e.ads.splice(t,1))}}mergeWrapperAdData(e,t){e.errorURLTemplates=t.errorURLTemplates.concat(e.errorURLTemplates),e.impressionURLTemplates=t.impressionURLTemplates.concat(e.impressionURLTemplates),e.extensions=t.extensions.concat(e.extensions),e.creatives.forEach(e=>{if(t.trackingEvents&&t.trackingEvents[e.type])for(let i in t.trackingEvents[e.type]){const r=t.trackingEvents[e.type][i];e.trackingEvents[i]||(e.trackingEvents[i]=[]),e.trackingEvents[i]=e.trackingEvents[i].concat(r)}}),t.videoClickTrackingURLTemplates&&t.videoClickTrackingURLTemplates.length&&e.creatives.forEach(e=>{"linear"===e.type&&(e.videoClickTrackingURLTemplates=e.videoClickTrackingURLTemplates.concat(t.videoClickTrackingURLTemplates))}),t.videoCustomClickURLTemplates&&t.videoCustomClickURLTemplates.length&&e.creatives.forEach(e=>{"linear"===e.type&&(e.videoCustomClickURLTemplates=e.videoCustomClickURLTemplates.concat(t.videoCustomClickURLTemplates))}),t.videoClickThroughURLTemplate&&e.creatives.forEach(e=>{"linear"===e.type&&null==e.videoClickThroughURLTemplate&&(e.videoClickThroughURLTemplate=t.videoClickThroughURLTemplate)})}}let H=null;const W={data:{},length:0,getItem(e){return this.data[e]},setItem(e,t){this.data[e]=t,this.length=Object.keys(this.data).length},removeItem(e){delete data[e],this.length=Object.keys(this.data).length},clear(){this.data={},this.length=0}};class j{constructor(){this.storage=this.initStorage()}initStorage(){if(H)return H;try{H="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(e){H=null}return H&&!this.isStorageDisabled(H)||(H=W).clear(),H}isStorageDisabled(e){const t="__VASTStorage__";try{if(e.setItem(t,t),e.getItem(t)!==t)return e.removeItem(t),!0}catch(e){return!0}return e.removeItem(t),!1}getItem(e){return this.storage.getItem(e)}setItem(e,t){return this.storage.setItem(e,t)}removeItem(e){return this.storage.removeItem(e)}clear(){return this.storage.clear()}}class q{constructor(e,t,i){this.cappingFreeLunch=e||0,this.cappingMinimumTimeInterval=t||0,this.defaultOptions={withCredentials:!1,timeout:0},this.vastParser=new F,this.util=new p,this.storage=i||new j,void 0===this.lastSuccessfulAd&&(this.lastSuccessfulAd=0),void 0===this.totalCalls&&(this.totalCalls=0),void 0===this.totalCallsTimeout&&(this.totalCallsTimeout=0)}getParser(){return this.vastParser}get lastSuccessfulAd(){return this.storage.getItem("vast-client-last-successful-ad")}set lastSuccessfulAd(e){this.storage.setItem("vast-client-last-successful-ad",e)}get totalCalls(){return this.storage.getItem("vast-client-total-calls")}set totalCalls(e){this.storage.setItem("vast-client-total-calls",e)}get totalCallsTimeout(){return this.storage.getItem("vast-client-total-calls-timeout")}set totalCallsTimeout(e){this.storage.setItem("vast-client-total-calls-timeout",e)}hasRemainingAds(){return this.vastParser.remainingAds.length>0}getNextAds(e){return this.vastParser.getRemainingAds(e)}get(e,t={}){const i=Date.now();return(t=Object.assign(this.defaultOptions,t)).hasOwnProperty("resolveAll")||(t.resolveAll=!1),this.totalCallsTimeout<i?(this.totalCalls=1,this.totalCallsTimeout=i+36e5):this.totalCalls++,new Promise((r,s)=>{if(this.cappingFreeLunch>=this.totalCalls)return s(new Error(`VAST call canceled – FreeLunch capping not reached yet ${this.totalCalls}/${this.cappingFreeLunch}`));const n=i-this.lastSuccessfulAd;if(n<0)this.lastSuccessfulAd=0;else if(n<this.cappingMinimumTimeInterval)return s(new Error(`VAST call canceled – (${this.cappingMinimumTimeInterval})ms minimum interval reached`));this.vastParser.getAndParseVAST(e,t).then(e=>r(e)).catch(e=>s(e))})}}class $ extends b{constructor(e,t,i,r=null){super(),this.ad=t,this.creative=i,this.variation=r,this.util=new p,this.muted=!1,this.impressed=!1,this.skippable=!1,this.skipDelayDefault=-1,this.trackingEvents={},this.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"],this._alreadyTriggeredQuartiles={};for(let e in this.creative.trackingEvents){const t=this.creative.trackingEvents[e];this.trackingEvents[e]=t.slice(0)}this.creative instanceof m?(this.setDuration(this.creative.duration),this.skipDelay=this.creative.skipDelay,this.linear=!0,this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates):(this.skipDelay=-1,this.linear=!1,this.variation&&(this.variation instanceof y?(this.clickThroughURLTemplate=this.variation.nonlinearClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.nonlinearClickTrackingURLTemplates):this.variation instanceof l&&(this.clickThroughURLTemplate=this.variation.companionClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.companionClickTrackingURLTemplates))),e&&this.on("start",()=>{e.lastSuccessfulAd=Date.now()})}setDuration(e){this.assetDuration=e,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}}setProgress(e){const t=this.skipDelay||this.skipDelayDefault;if(-1===t||this.skippable||(t>e?this.emit("skip-countdown",t-e):(this.skippable=!0,this.emit("skip-countdown",0))),this.linear&&this.assetDuration>0){const t=[];if(e>0){const i=Math.round(e/this.assetDuration*100);t.push("start"),t.push(`progress-${i}%`),t.push(`progress-${Math.round(e)}`);for(let i in this.quartiles)this.isQuartileReached(i,this.quartiles[i],e)&&(t.push(i),this._alreadyTriggeredQuartiles[i]=!0)}t.forEach(e=>{this.track(e,!0)}),e<this.progress&&this.track("rewind")}this.progress=e}isQuartileReached(e,t,i){let r=!1;return t<=i&&!this._alreadyTriggeredQuartiles[e]&&(r=!0),r}setMuted(e){this.muted!==e&&this.track(e?"mute":"unmute"),this.muted=e}setPaused(e){this.paused!==e&&this.track(e?"pause":"resume"),this.paused=e}setFullscreen(e){this.fullscreen!==e&&this.track(e?"fullscreen":"exitFullscreen"),this.fullscreen=e}setExpand(e){this.expanded!==e&&this.track(e?"expand":"collapse"),this.expanded=e}setSkipDelay(e){"number"==typeof e&&(this.skipDelay=e)}trackImpression(){this.impressed||(this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates),this.track("creativeView"))}errorWithCode(e){this.trackURLs(this.ad.errorURLTemplates,{ERRORCODE:e})}complete(){this.track("complete")}close(){this.track(this.linear?"closeLinear":"close")}skip(){this.track("skip"),this.trackingEvents=[]}click(){if(this.clickTrackingURLTemplates&&this.clickTrackingURLTemplates.length&&this.trackURLs(this.clickTrackingURLTemplates),this.clickThroughURLTemplate){const e=this.linear?{CONTENTPLAYHEAD:this.progressFormatted()}:{},t=this.util.resolveURLTemplates([this.clickThroughURLTemplate],e)[0];this.emit("clickthrough",t)}}track(e,t=!1){"closeLinear"===e&&!this.trackingEvents[e]&&this.trackingEvents.close&&(e="close");const i=this.trackingEvents[e],r=this.emitAlwaysEvents.indexOf(e)>-1;i?(this.emit(e,""),this.trackURLs(i)):r&&this.emit(e,""),t&&(delete this.trackingEvents[e],r&&this.emitAlwaysEvents.splice(this.emitAlwaysEvents.indexOf(e),1))}trackURLs(e,t={}){this.linear&&(this.creative&&this.creative.mediaFiles&&this.creative.mediaFiles[0]&&this.creative.mediaFiles[0].fileURL&&(t.ASSETURI=this.creative.mediaFiles[0].fileURL),t.CONTENTPLAYHEAD=this.progressFormatted()),this.util.track(e,t)}progressFormatted(){const e=parseInt(this.progress);let t=e/3600;t.length<2&&(t=`0${t}`);let i=e/60%60;i.length<2&&(i=`0${i}`);let r=e%60;return r.length<2&&(r=`0${i}`),`${t}:${i}:${r}.${parseInt(100*(this.progress-e))}`}}var X=i(2),z=i.n(X);function Q(e,t,i){const r=["application/x-javascript","text/javascript","application/javascript"],s=t.mediaFiles.find(e=>"VPAID"===e.apiFramework&&(e=>r.indexOf(e.mimeType.trim())>-1)(e));if(!s)return console.warn("Only JavaScript VPAID is supported by this player"),void this.player.trigger("adscanceled");const n=e.el().querySelector(".vjs-tech"),a=document.createElement("div");a.className=i.vpaid.containerClass,a.id=i.vpaid.containerId,e.el().insertBefore(a,e.controlBar.el());const o=new z.a(a,n,{});e.ads.startLinearAdMode(),e.pause(),e.controlBar.hide(),o.loadAdUnit(s.fileURL,(function(r,s){if(r)return console.error(r),e.controlBar.show(),void e.trigger("aderror");let n;function l(){const t=G(e);s.resizeAd(t.width,t.height,e.isFullscreen()?"fullscreen":"normal")}s.handshakeVersion("2.0",(function(r,o){const l=G(e),c={AdParameters:t.adParameters},h=i.vpaid.videoInstance;"same"===h?n=e.tech({kindaKnowWhatImDoing:!0}).el():"new"===h?(n=document.createElement("video"),n.style.cssText="position:absolute; top:0; left:0; z-index:2 !important;",a.appendChild(n)):("none"!==h&&console.warn(h+" is an invalid videoInstance value. Defaulting to 'none'."),n=null);const p={slot:a,videoSlot:n};s.initAd(l.width,l.height,"normal",-1,c,p)})),s.subscribe("AdLoaded",(function(){s.startAd()})),s.subscribe("AdStarted",(function(){e.trigger("ads-ad-started"),e.on("resize",l),window.addEventListener("resize",l)})),s.subscribe("AdStopped",(function(){o.destroy(),e.controlBar.show(),e.off("resize",l),window.removeEventListener("resize",l),e.trigger("adended"),e.ads.endLinearAdMode(),"new"===i.vpaid.videoInstance&&n.parentElement&&n.parentElement.removeChild(n)}))}))}function G(e){let t=e.width(),i=e.height();return e.isFullscreen()&&(t=window.innerWidth,i=window.innerHeight),{width:t,height:i}}const Y=s.a.getPlugin("plugin");const J=window,K={seekEnabled:!1,controlsEnabled:!1,wrapperLimit:10,withCredentials:!0,skip:0,vpaid:{containerId:void 0,containerClass:"vjs-vpaid-container",videoInstance:"none"}};s.a.registerPlugin("vast",class extends Y{constructor(e,t){super(e),"function"==typeof e.ads&&e.ads({debug:!1}),t=s.a.mergeOptions(K,t||{}),this.options=t,this.vastClient=new q,this.originalPlayerState={},this.eventListeners={},this.domElements={},this.vastCreative=null,e.on("contentchanged",()=>{console.log("Content changed")}),e.on("readyforpreroll",()=>{console.log("Trigger read for preroll"),!function(e){const t=e.mediaFiles;for(let e=0;e<t.length;e++)if(t[e].apiFramework&&"VPAID"===t[e].apiFramework)return!0;return!1}(this.vastCreative)?this._doPreroll(this.vastCreative):Q(e,this.vastCreative,t)}),this._getVastContent().then(e=>this._handleVast(e)).catch(e=>{this.player.trigger("adscanceled"),console.log(`Ad cancelled: ${e.message}`)})}_handleVast(e){if(!e.ads||0===e.ads.length)return void this.player.trigger("adscanceled");const t=e=>"linear"===e.type,i=e.ads.find(e=>e.creatives.some(t)),r=i.creatives.find(t),s=i.creatives.find(e=>"companion"===e.type),n=this.options;if(n.companion&&s){const e=s.variations.find(e=>e.width===String(n.companion.maxWidth)&&e.height===String(n.companion.maxHeight));if(e&&e.staticResource)if(0===e.type.indexOf("image")){const t=e.companionClickThroughURLTemplate,i=J.document.getElementById(n.companion.elementId);let r;r=t?`<a href="${t}" target="_blank"><img src="${e.staticResource}"/></a>`:`<img src="${e.staticResource}"/>`,i.innerHTML=r}else["application/x-javascript","text/javascript","application/javascript"].indexOf(e.type)>-1||e.type}this.tracker=new $(this.vastClient,i,r,s),this.vastCreative=r,r.mediaFiles.length?(console.log("Trigger ads ready"),this.player.trigger("adsready")):this.player.trigger("adscanceled")}_getVastContent(){let{url:e,xml:t}=this.options;if(e)return this.vastClient.get(e,{withCredentials:this.options.withCredentials,wrapperLimit:this.options.wrapperLimit});if(t){const e=new F;let i;if(t.constructor===window.XMLDocument)i=t;else{if(t.constructor!==String)throw new Error("xml config option must be a String or XMLDocument");i=(new window.DOMParser).parseFromString(t,"text/xml")}return e.parseVAST(i)}return Promise.reject(new Error("url or xml option not set"))}_doPreroll(e){const t=this.player,i=this.options;t.ads.startLinearAdMode(),this.originalPlayerState.controlsEnabled=t.controls(),t.controls(i.controlsEnabled),this.originalPlayerState.seekEnabled=t.controlBar.progressControl.enabled(),i.seekEnabled?t.controlBar.progressControl.enable():t.controlBar.progressControl.disable(),t.src(e.mediaFiles.map(e=>({type:e.mimeType,src:e.fileURL})));const r=J.document.createElement("div");r.className="vast-blocker",r.onclick=()=>{if(t.paused())return t.play(),!1;this.tracker.click()},this.tracker.on("clickthrough",e=>{J.open(e,"_blank")}),this.domElements.blocker=r,t.el().insertBefore(r,t.controlBar.el());const s=J.document.createElement("div");s.className="vast-skip-button",s.style.display="none",this.domElements.skipButton=s,t.el().appendChild(s),this.eventListeners.adtimeupdate=()=>this._timeUpdate(),t.one("adplay",()=>{this.options.skip>0&&t.duration()>=this.options.skip&&(s.style.display="block",t.on("adtimeupdate",this.eventListeners.adtimeupdate)),this.player.loadingSpinner.el().style.display="none"}),this.eventListeners.teardown=()=>this._tearDown(),s.onclick=e=>{if((" "+s.className+" ").indexOf(" enabled ")>=0&&(this.tracker.skip(),this.eventListeners.teardown()),void 0===J.Event.prototype.stopPropagation)return!1;e.stopPropagation()},this._setupEvents(),t.one("adended",this.eventListeners.teardown)}_timeUpdate(){const e=this.player;e.loadingSpinner.el().style.display="none";const t=Math.ceil(this.options.skip-e.currentTime());t>0?this.domElements.skipButton.innerHTML="Skip in "+t+"...":-1===(" "+this.domElements.skipButton.className+" ").indexOf(" enabled ")&&(this.domElements.skipButton.className+=" enabled ",this.domElements.skipButton.innerHTML="Skip")}_tearDown(){Object.values(this.domElements).forEach(e=>e.parentNode.removeChild(e));const e=this.player;e.off("adtimeupdate",this.eventListeners.adtimeupdate),e.ads.endLinearAdMode(),e.controls(this.originalPlayerState.controlsEnabled),this.originalPlayerState.seekEnabled?e.controlBar.progressControl.enable():e.controlBar.progressControl.disable(),e.trigger("vast-done")}_setupEvents(){const e=this.player,t=this.tracker;let i=!1;const r=function(){t.trackImpression()},s=function(){isNaN(t.assetDuration)&&(t.assetDuration=e.duration()),t.setProgress(e.currentTime())},n=function(){t.setPaused(!0),e.one("adplay",(function(){t.setPaused(!1)}))},a=function(){t.errorWithCode("405"),i=!0,e.error(null),e.trigger("adended")},o=function(){t.setFullscreen(e.isFullscreen())},l=function(){let i=e.muted(),r=e.volume();return function(){const s=e.volume(),n=e.muted();i!==n?(t.setMuted(n),i=n):r!==s&&(r>0&&0===s?t.setMuted(!0):0===r&&s>0&&t.setMuted(!1),r=s)}}();e.on("adcanplay",r),e.on("adtimeupdate",s),e.on("adpause",n),e.on("aderror",a),e.on("advolumechange",l),e.on("fullscreenchange",o),e.one("vast-done",(function(){e.off("adcanplay",r),e.off("adtimeupdate",s),e.off("adpause",n),e.off("aderror",a),e.off("advolumechange",l),e.off("fullscreenchange",o),i||t.complete()}))}})}]);